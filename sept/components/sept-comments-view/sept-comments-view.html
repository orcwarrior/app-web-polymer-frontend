<link rel="import" href="../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../../bower_components/core-collapse/core-collapse.html">
<link rel="import" href="../../../bower_components/core-icons/communication-icons.html">

<polymer-element name="sept-comments-view" attributes="comments">
    <template>
        <link rel="stylesheet" type="text/css" href="sept-comments-view.css" shim-shadowdom/>
        <section id="commentsSection" class="bottom" on-core-resize="{{commentsStateChangeEnd}}">
            <section id="commentsHeader">
                <core-icon-button icon="communication:forum" on-tap="{{toggleComments}}">
                    Komentarze({{commentsCount}})
                    <core-icon icon="expand-more" hidden?="{{$.commentsDropdown.opened}}"></core-icon>
                    <core-icon icon="expand-less" hidden?="{{!$.commentsDropdown.opened}}"></core-icon>
                </core-icon-button>
            </section>
            <core-collapse id="commentsDropdown">
                <template repeat="{{comment in comments}}">
                    <div id="comment">
                        <div id="commentWrapper">
                            <div id="commentInfos">
                                <div id="commentAuthor">{{comment.author}}</div>
                                <div id="commentDate">{{comment.created}}</div>
                            </div>
                            <div id="commentContent">{{comment.content}}</div>
                        </div>
                    </div>
                </template>
                <div id="commentWriter">
                    <div id="comment">
                        <div id="commentWrapper">
                            <div id="commentInfos">
                                <div id="commentAuthor">{{currentUserName}}</div>
                                <div id="commentDate"></div>
                            </div>
                            <div id="commentContent" contenteditable="true"
                                 data-ph="Tutaj wpisz treść nowego komentarza...">
                                {{newCommentContent}}
                            </div>
                        </div>
                    </div>
                </div>
                <div id="commentNoUserWarning" hidden?="{{userLoggedIn}}">
                Zaloguj się aby pisać komentarze.
                </div>
            </core-collapse>
        </section>
    </template>

    <script>
        Polymer('sept-comments-view', {
            commentsCount : 0, // declared for save not-null use
            userLoggedIn : false,
            ready : function() {
            },
            currentUserName : "",
            commentsChanged : function() {
                this.commentsCount = this.comments.length;
            },
            toggleComments : function() {
                this.updateUser();
                this.$.commentsDropdown.toggle();
            },
            commentsStateChangeEnd : function() {
                this.fire('toggle-comments', { scrollOffset: 9999+128});
            },
            updateUser : function() {
                this.userLoggedIn = septEngine.user.isLoggedIn();
                this.currentUserName = (this.userLoggedIn) ? septEngine.user.session.user.username : "Niezalogowany";
            }
        });
    </script>
</polymer-element>